<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>üóÇÔ∏è Organizador de Canales por Pa√≠s o Categor√≠a</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);
            min-height: 100vh;
            font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
            transition: background 0.3s;
        }

        body.darkmode,
        .darkmode-preload body {
            background: linear-gradient(135deg, #18181b 0%, #312e81 100%);
        }

        .deluxe-card {
            background: #fff;
            border-radius: 2rem;
            box-shadow: 0 8px 32px rgba(60, 60, 120, 0.12);
            padding: 2.5rem 2rem;
            max-width: 700px;
            margin: 2rem auto 4rem;
            transition: box-shadow 0.3s, background 0.3s;
        }

        .darkmode-preload .deluxe-card,
        body.darkmode .deluxe-card {
            background: #23233a;
            box-shadow: 0 8px 32px rgba(30, 30, 60, 0.22);
        }

        .deluxe-title {
            font-weight: 800;
            font-size: 2.3rem;
            letter-spacing: -1px;
            color: #3b3b5c;
            margin-bottom: 0.5rem;
            transition: color 0.3s;
            text-align: center;
        }

        .darkmode-preload .deluxe-title,
        body.darkmode .deluxe-title {
            color: #f3f4f6;
        }

        .deluxe-label {
            font-weight: 600;
            color: #6366f1;
            margin-bottom: 0.3rem;
            transition: color 0.3s;
            display: block;
        }

        .darkmode-preload .deluxe-label,
        body.darkmode .deluxe-label {
            color: #a5b4fc;
        }

        .deluxe-section {
            margin-bottom: 1.5rem;
        }

        select.form-select,
        input.form-control,
        textarea.form-control {
            border-radius: 1.2rem;
            font-size: 1rem;
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 4px rgba(60, 60, 120, 0.04);
            transition: box-shadow 0.2s, background 0.3s, color 0.3s, border 0.3s;
            color: #23233a;
        }

        select.form-select:focus,
        input.form-control:focus,
        textarea.form-control:focus {
            box-shadow: 0 2px 8px rgba(60, 60, 120, 0.10);
            border-color: #6366f1;
            background: #eef2ff;
            outline: none;
        }

        .darkmode-preload select.form-select,
        .darkmode-preload input.form-control,
        .darkmode-preload textarea.form-control,
        body.darkmode select.form-select,
        body.darkmode input.form-control,
        body.darkmode textarea.form-control {
            background: #23233a;
            color: #f3f4f6;
            border: 1px solid #6366f1;
        }

        .darkmode-toggle {
            position: absolute;
            top: 32px;
            right: 32px;
            z-index: 10;
            background: #fff;
            border-radius: 2rem;
            box-shadow: 0 2px 8px rgba(60, 60, 120, 0.10);
            padding: 0.4rem 1.2rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #6366f1;
            border: none;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }

        .darkmode-toggle:hover {
            background: #6366f1;
            color: #fff;
        }

        .darkmode-preload .darkmode-toggle {
            background: #23233a;
            color: #a5b4fc;
        }

        .darkmode-preload .darkmode-toggle:hover {
            background: #818cf8;
            color: #23233a;
        }

        body.darkmode .darkmode-toggle {
            background: #23233a;
            color: #a5b4fc;
        }

        body.darkmode .darkmode-toggle:hover {
            background: #818cf8;
            color: #23233a;
        }

        button.deluxe-btn {
            font-size: 1.1rem;
            border-radius: 1.5rem;
            padding: 0.75rem 2rem;
            box-shadow: 0 2px 8px rgba(60, 60, 120, 0.08);
            transition: background 0.2s, box-shadow 0.2s, transform 0.15s;
            font-weight: 600;
            letter-spacing: 0.02em;
            border: none;
            cursor: pointer;
        }

        button.deluxe-btn:active {
            transform: scale(0.98);
        }

        .btn-primary.deluxe-btn {
            background: linear-gradient(90deg, #4f46e5 0%, #6366f1 100%);
            color: #fff;
            border: none;
            text-shadow: 0 1px 2px rgba(60, 60, 120, 0.18);
        }

        .btn-primary.deluxe-btn:hover {
            background: linear-gradient(90deg, #6366f1 0%, #818cf8 100%);
            color: #fff;
        }

        .output {
            white-space: pre-wrap;
            background: #fdf6e3;
            border: 1px solid #fbbf24;
            color: #3b3b5c;
            font-weight: 500;
            border-radius: 1.2rem;
            padding: 1rem;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            margin-top: 1rem;
            transition: background 0.3s, border-color 0.3s, color 0.3s;
        }

        .darkmode-preload .output,
        body.darkmode .output {
            background: #312e81;
            border: 1px solid #818cf8;
            color: #f3f4f6;
        }

        /* Gu√≠a JSON */
        #jsonGuide {
            font-family: monospace;
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 1.2rem;
            padding: 1rem;
            margin-top: 2rem;
            color: #23233a;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .darkmode-preload #jsonGuide,
        body.darkmode #jsonGuide {
            background: #23233a;
            border: 1px solid #6366f1;
            color: #a5b4fc;
        }

        .deluxe-desc {
            font-size: 1.1rem;
            color: #6b7280;
            margin-bottom: 2rem;
            transition: color 0.3s;
        }

        .darkmode-preload .deluxe-desc {
            color: #a5b4fc;
        }

        body.darkmode .deluxe-desc {
            color: #a5b4fc;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 0.5rem;
            font-size: 0.95rem;
            color: #3b3b5c;
            font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
        }

        thead tr {
            background: #6366f1;
            color: white;
            font-weight: 600;
            border-radius: 1.5rem;
        }

        thead th {
            padding: 0.75rem 1rem;
            text-align: left;
        }

        tbody tr {
            background: #f3f4f6;
            box-shadow: 0 1px 4px rgba(60, 60, 120, 0.1);
            border-radius: 1.2rem;
            transition: background 0.3s, box-shadow 0.3s;
        }

        tbody tr:hover {
            background: #e0e7ff;
            box-shadow: 0 4px 12px rgba(60, 60, 120, 0.15);
        }

        tbody td {
            padding: 0.65rem 1rem;
            vertical-align: middle;
        }

        /* Quitar bordes dobles en separaci√≥n (dejar bordes redondeados) */
        tbody tr td:first-child {
            border-top-left-radius: 1.2rem;
            border-bottom-left-radius: 1.2rem;
        }

        tbody tr td:last-child {
            border-top-right-radius: 1.2rem;
            border-bottom-right-radius: 1.2rem;
        }

        /* Modo oscuro */
        body.darkmode table {
            color: #f3f4f6;
        }

        body.darkmode thead tr {
            background: #818cf8;
            color: #23233a;
        }

        body.darkmode tbody tr {
            background: #2c2c4a;
            box-shadow: 0 1px 4px rgba(100, 100, 180, 0.3);
        }

        body.darkmode tbody tr:hover {
            background: #3b3b66;
            box-shadow: 0 4px 12px rgba(100, 100, 180, 0.5);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .deluxe-card {
                margin: 1rem 1rem 3rem;
                padding: 2rem 1.5rem;
            }
        }

        .floating-button {
            position: absolute;
            top: 80px;
            /* Justo debajo del bot√≥n de modo oscuro */
            right: 32px;
            z-index: 10;
            background: #fff;
            border-radius: 2rem;
            box-shadow: 0 2px 8px rgba(60, 60, 120, 0.10);
            padding: 0.4rem 1.2rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: #6366f1;
            border: none;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }

        .floating-button:hover {
            background: #6366f1;
            color: #fff;
        }

        body.darkmode .floating-button {
            background: #23233a;
            color: #a5b4fc;
        }

        body.darkmode .floating-button:hover {
            background: #818cf8;
            color: #23233a;
        }
    </style>
</head>

<body>
    <main>
        <div class="deluxe-card" role="main" aria-label="Organizador de canales por pa√≠s o categor√≠a">
            <h1 class="deluxe-title">üóÇÔ∏è Organizador de Canales</h1>
            <p class="deluxe-desc text-center">
                Este sitio solo funciona con archivos JSON que sigan el formato del repositorio <a
                    href="https://github.com/Alplox/json-teles" target="_blank" rel="noopener">json-teles</a> y/o
                variaciones compatibles. Si tu archivo no sigue ese formato, la organizaci√≥n puede fallar.
            </p>
            <button id="cargarDefectoBtn" class="btn btn-secondary deluxe-btn w-100 mb-3"
                aria-label="Cargar lista por defecto">üìÇ Cargar URL canales desde json-teles</button>

            <div class="deluxe-section">
                <label for="jsonUrl" class="deluxe-label">üåê URL del JSON:</label>
                <input type="text" id="jsonUrl" class="form-control" placeholder="https://ejemplo.com/canales.json"
                    aria-describedby="jsonUrlHelp" />
            </div>

            <div class="deluxe-section">
                <label for="fileInput" class="deluxe-label">üìÅ Subir un archivo JSON:</label>
                <input type="file" id="fileInput" class="form-control" accept=".json" />
            </div>

            <div class="deluxe-section">
                <label for="modo" class="deluxe-label">Organizar por:</label>
                <select id="modo" class="form-select" aria-label="Seleccionar modo de organizaci√≥n">
                    <option value="pais">Pa√≠s</option>
                    <option value="categoria">Categor√≠a</option>
                </select>
            </div>

            <button id="procesarBtn" class="btn btn-primary deluxe-btn w-100" aria-live="polite"
                aria-atomic="true">Procesar JSON</button>

            <label for="output" class="deluxe-label mt-2">üìÑ Resultado:</label>
            <pre id="resultado" class="output m-0" tabindex="0" aria-live="polite" aria-atomic="true"
                aria-label="Resultado del procesamiento"></pre>

            <section id="jsonGuide" aria-label="Gu√≠a r√°pida estructura JSON">
                <h2>Gu√≠a r√°pida de la estructura JSON</h2>
                <p>El JSON debe tener la siguiente estructura para cada canal:</p>
                <pre><code>
{
  "noticiero-generico-id": {
    "nombre": "noticiero gen√©rico",
    "logo": "https://logo.png",
    "se√±ales": {
      "iframe_url": [
        "https://...",
        "https://..."
      ],
      "m3u8_url": [
        "https://....m3u8"
      ],
      "yt_id": "",
      "yt_embed": "",
      "yt_playlist": "",
      "twitch_id": ""
    },
    "sitio_oficial": "https://www.sitio-noticiero.com/envivo/",
    "pa√≠s": "cl",
    "categor√≠a": "news"
  }
}
</code></pre>
            </section>
            <table>
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>Tipo</th>
                        <th>Descripci√≥n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>noticiero-generico-id</code></td>
                        <td>string</td>
                        <td>ID √∫nico del canal, en min√∫sculas y con guiones.</td>
                    </tr>
                    <tr>
                        <td><code>nombre</code></td>
                        <td>string</td>
                        <td>Nombre del canal.</td>
                    </tr>
                    <tr>
                        <td><code>logo</code></td>
                        <td>string</td>
                        <td>URL del logo (PNG, SVG, JPG...)</td>
                    </tr>
                    <tr>
                        <td><code>se√±ales</code></td>
                        <td>object</td>
                        <td>URLs de las se√±ales del canal.</td>
                    </tr>
                    <tr>
                        <td><code>iframe_url</code></td>
                        <td>array</td>
                        <td>Embeds o sitios con reproductores del canal.</td>
                    </tr>
                    <tr>
                        <td><code>m3u8_url</code></td>
                        <td>array</td>
                        <td>Solo enlaces HLS terminados en <code>.m3u8</code>.</td>
                    </tr>
                    <tr>
                        <td><code>yt_id</code></td>
                        <td>string</td>
                        <td>ID del canal de YouTube.</td>
                    </tr>
                    <tr>
                        <td><code>yt_embed</code></td>
                        <td>string</td>
                        <td>URL de YouTube embebida.</td>
                    </tr>
                    <tr>
                        <td><code>yt_playlist</code></td>
                        <td>string</td>
                        <td>ID de una playlist de YouTube.</td>
                    </tr>
                    <tr>
                        <td><code>twitch_id</code></td>
                        <td>string</td>
                        <td>ID de canal de Twitch.</td>
                    </tr>
                    <tr>
                        <td><code>sitio_oficial</code></td>
                        <td>string</td>
                        <td>Enlace al sitio oficial del canal.</td>
                    </tr>
                    <tr>
                        <td><code>pa√≠s</code></td>
                        <td>string</td>
                        <td>C√≥digo ISO 3166 (en min√∫scula).</td>
                    </tr>
                    <tr>
                        <td><code>categor√≠a</code></td>
                        <td>string</td>
                        <td>Compatible con <a href="https://iptv-org.github.io/api/categories.json"
                                target="_blank">iptv-org</a>.</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <button id="pageToggle" class="floating-button" aria-label="Cambiar de vista">Ir a üßæ Convertidor .JSON a
            .M3U</button>
        <button id="themeToggle" class="darkmode-toggle" aria-pressed="false" aria-label="Alternar modo oscuro">üåó
            Cambiar tema</button>
    </main>

    <script>
        document.getElementById('pageToggle').addEventListener('click', () => {
            const currentUrl = window.location.href;

            if (currentUrl.includes('organizador.html')) {
                window.location.href = 'index.html';
            } else {
                window.location.href = 'organizador.html';
            }
        });

        let codigosPais = null;
        const URL_PREDEFINIDA = "https://raw.githubusercontent.com/Alplox/json-teles/refs/heads/main/canales.json";

        // Alternar modo oscuro
        const darkModeToggle = document.getElementById('themeToggle');

        darkModeToggle.addEventListener('click', () => {
            const pressed = darkModeToggle.getAttribute('aria-pressed') === 'true';
            const isDark = !pressed;

            setDarkMode(isDark);
            localStorage.setItem('darkmode', isDark);
            darkModeToggle.setAttribute('aria-pressed', String(isDark));
        });

        // Darkmode persistente
        function setDarkMode(enabled) {
            document.body.classList.toggle('darkmode', enabled);
            document.documentElement.classList.toggle('darkmode-preload', enabled);
            document.getElementById('themeToggle').textContent = enabled ? '‚òÄÔ∏è Modo claro' : 'üåô Modo oscuro';
        }

        // Leer preferencia al cargar
        const darkPref = localStorage.getItem('darkmode') === 'true';
        setDarkMode(darkPref);
        darkModeToggle.setAttribute('aria-pressed', String(darkPref));

        async function cargarCodigosPais() {
            try {
                const resp = await fetch('https://flagcdn.com/es/codes.json');
                if (!resp.ok) throw new Error('No se pudo obtener la lista de pa√≠ses.');
                codigosPais = await resp.json();
            } catch {
                codigosPais = {};
            }
        }

        function generarTextoPorPais(data) {
            const porPais = {};
            for (const key in data) {
                const c = data[key];
                const pais = c.pa√≠s;
                porPais[pais] = porPais[pais] || [];
                porPais[pais].push(c);
            }

            let texto = '';
            for (const pais in porPais) {
                const nombre = codigosPais?.[pais] || 'Pa√≠s Desconocido';
                texto += `Canales "${nombre}"\n`;
                porPais[pais].forEach(c => {
                    texto += `- [${c.nombre}](${c.sitio_oficial}) [${c.categor√≠a}]\n`;
                });
                texto += '\n';
            }
            return texto;
        }

        function generarTextoPorCategoria(data) {
            const porCategoria = {};
            for (const key in data) {
                const c = data[key];
                const cat = c.categor√≠a;
                porCategoria[cat] = porCategoria[cat] || [];
                porCategoria[cat].push(c);
            }

            let texto = '';
            for (const cat in porCategoria) {
                texto += `Categor√≠a "${cat}"\n`;
                porCategoria[cat].forEach(c => {
                    const nombrePais = codigosPais?.[c.pa√≠s] || 'Desconocido';
                    texto += `- [${c.nombre}](${c.sitio_oficial}) [${nombrePais}]\n`;
                });
                texto += '\n';
            }
            return texto;
        }

        document.getElementById('cargarDefectoBtn').addEventListener('click', async () => {
            const inputUrl = document.getElementById('jsonUrl');
            const fileInput = document.getElementById('fileInput');
            inputUrl.value = URL_PREDEFINIDA;
            fileInput.value = ''; // Limpiar input de archivos
            document.getElementById('procesarBtn').click(); // Disparar procesamiento
        });


        document.getElementById('procesarBtn').addEventListener('click', async () => {
            const url = document.getElementById('jsonUrl').value.trim();
            const fileInput = document.getElementById('fileInput');
            const modo = document.getElementById('modo').value;
            const resultadoDiv = document.getElementById('resultado');

            if (codigosPais === null) await cargarCodigosPais();

            let jsonData = null;

            try {
                if (url) {
                    const res = await fetch(url);
                    if (!res.ok) throw new Error("No se pudo obtener el JSON desde la URL.");
                    jsonData = await res.json();
                } else if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    const text = await file.text();
                    jsonData = JSON.parse(text);
                } else {
                    alert("Por favor, ingresa una URL o sube un archivo JSON.");
                    return;
                }

                const resultadoTexto = modo === 'pais'
                    ? generarTextoPorPais(jsonData)
                    : generarTextoPorCategoria(jsonData);

                resultadoDiv.textContent = resultadoTexto;
                resultadoDiv.classList.add('visible');
            } catch (err) {
                resultadoDiv.textContent = "‚ö†Ô∏è Error: " + err.message;
                resultadoDiv.classList.add('visible');
            }
        });
    </script>

</body>

</html>